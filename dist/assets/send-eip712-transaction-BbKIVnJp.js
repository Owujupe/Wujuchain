import{e as v}from"./eth_sendRawTransaction-DPdnXbFR.js";import{ah as U,aa as S,ai as B,P as x,a7 as A,aj as D,ak as l,e as M,a0 as $,d as O,f as c,a9 as w,I as H,L as k,n as d,m as W}from"./index-fFHDa7eL.js";import{concatHex as R}from"./concat-hex-B7nHc2Z0.js";function C(t,e="hex"){const n=T(t),s=U(new Uint8Array(n.length));return n.encode(s),e==="hex"?S(s.bytes):s.bytes}function T(t){return Array.isArray(t)?N(t.map(e=>T(e))):V(t)}function N(t){const e=t.reduce((a,r)=>a+r.length,0),n=I(e);return{length:e<=55?1+e:1+n+e,encode(a){e<=55?a.pushByte(192+e):(a.pushByte(247+n),n===1?a.pushUint8(e):n===2?a.pushUint16(e):n===3?a.pushUint24(e):a.pushUint32(e));for(const{encode:r}of t)r(a)}}}function V(t){const e=typeof t=="string"?B(t):t,n=I(e.length);return{length:e.length===1&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length,encode(a){e.length===1&&e[0]<128?a.pushBytes(e):e.length<=55?(a.pushByte(128+e.length),a.pushBytes(e)):(a.pushByte(183+n),n===1?a.pushUint8(e.length):n===2?a.pushUint16(e.length):n===3?a.pushUint24(e.length):a.pushUint32(e.length),a.pushBytes(e))}}}function I(t){if(t<2**8)return 1;if(t<2**16)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new x("Length is too large.")}const Z=2n**16n-1n;function q(t,e){const n=A(D(t,{strict:!1})?l(t):t);return M(n)}function f(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${t} of type ${typeof t}`);return t instanceof Uint8Array?BigInt($(t)):BigInt(t)}const P=(t,e)=>typeof t=="bigint"?e(t):Array.isArray(t)?t.map(n=>P(n,e)):t&&typeof t=="object"?Object.fromEntries(Object.entries(t).map(([n,s])=>[n,P(s,e)])):t,b=Z*32n;class J extends x{constructor({givenLength:e,maxBytecodeSize:n}){super(`Bytecode cannot be longer than ${n} bytes. Given length: ${e}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class K extends x{constructor({givenLengthInWords:e}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${e}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class Q extends x{constructor({givenLength:e}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${e}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function X(t){const e=l(t);if(e.length%32!==0)throw new Q({givenLength:e.length});if(e.length>b)throw new J({givenLength:e.length,maxBytecodeSize:b});const n=q(e),s=l(n),a=e.length/32;if(a%2===0)throw new K({givenLengthInWords:a});const r=l(a),i=O(r,{size:2}),o=new Uint8Array([1,0]);return s.set(o,0),s.set(i,2),s}const L=50000n,Y=t=>{const e=j(t);return{domain:{name:"zkSync",version:"2",chainId:t.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:e}};function j(t){const{gas:e,nonce:n,to:s,from:a,value:r,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:u,paymasterInput:y,gasPerPubdata:g,data:m,factoryDeps:p}=t;return{txType:113n,from:BigInt(a),to:s?BigInt(s):0n,gasLimit:e??0n,gasPerPubdataByteLimit:g??L,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,paymaster:u?BigInt(u):0n,nonce:n?BigInt(n):0n,value:r??0n,data:m||"0x0",factoryDeps:(p==null?void 0:p.map(h=>c(X(h))))??[],paymasterInput:y||"0x"}}async function ee(t){const{account:e,transaction:n}=t,s=await F(t),a=await E({account:e,eip712Transaction:s,chainId:n.chain.id}),r=w(n);return{transactionHash:await v(r,a),chain:n.chain,client:n.client}}async function E(t){const{account:e,eip712Transaction:n,chainId:s}=t,a=Y(n),r=await e.signTypedData({...a});return te({...n,chainId:s,customSignature:r})}async function F(t){const{account:e,transaction:n}=t,{gas:s,maxFeePerGas:a,maxPriorityFeePerGas:r,gasPerPubdata:i}=await G({transaction:n,from:H(e.address)});return{...await k({transaction:{...n,gas:s,maxFeePerGas:a,maxPriorityFeePerGas:r},from:e.address}),...n.eip712,gasPerPubdata:i,from:e.address}}function te(t){const{chainId:e,gas:n,nonce:s,to:a,from:r,value:i,maxFeePerGas:o,maxPriorityFeePerGas:u,customSignature:y,factoryDeps:g,paymaster:m,paymasterInput:p,gasPerPubdata:h,data:_}=t,z=[s?c(s):"0x",u?c(u):"0x",o?c(o):"0x",n?c(n):"0x",a??"0x",i?c(i):"0x",_??"0x0",c(e),c(""),c(""),c(e),r??"0x",h?c(h):c(L),g??[],y??"0x",m&&p?[m,p]:[]];return R(["0x71",C(z)])}async function G(t){const{transaction:e,from:n}=t;let[s,a,r,i]=await Promise.all([d(e.gas),d(e.maxFeePerGas),d(e.maxPriorityFeePerGas),d(e.eip712)]),o=i==null?void 0:i.gasPerPubdata;if(s===void 0||a===void 0||r===void 0){const u=w(e),y=await ne({transaction:e,from:n}),g=await u({method:"zks_estimateFee",params:[P(y,c)]});s=f(g.gas_limit)*2n,a=f(g.max_fee_per_gas)*2n,r=f(g.max_priority_fee_per_gas)||1n,o=f(g.gas_per_pubdata_limit)*2n,o<50000n&&(o=50000n)}return{gas:s,maxFeePerGas:a,maxPriorityFeePerGas:r,gasPerPubdata:o}}async function ne(t){var u;const{transaction:e,from:n}=t,[s,a,r,i]=await Promise.all([W(e),d(e.to),d(e.value),d(e.eip712)]),o=i==null?void 0:i.gasPerPubdata;return{from:n,to:a,data:s,value:r,gasPerPubdata:o,eip712Meta:{...i,gasPerPubdata:o||50000n,factoryDeps:(u=i==null?void 0:i.factoryDeps)==null?void 0:u.map(y=>Array.from(B(y)))},type:"0x71"}}const ie=Object.freeze(Object.defineProperty({__proto__:null,getZkGasFees:G,populateEip712Transaction:F,sendEip712Transaction:ee,signEip712Transaction:E},Symbol.toStringTag,{value:"Module"}));export{ie as a,F as p,E as s,f as t};
